<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sales Summary 374959384</title>
  <!-- Bootstrap 5 from jsDelivr -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Small custom styles for layout */
    body { padding-top: 3.5rem; }
    .hero { max-width: 900px; margin: 0 auto; }
    .card { margin-top: 1rem; }
    .loading { font-style: italic; color: #6c757d; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#">Sales Summary</a>
    </div>
  </nav>

  <main class="container hero">
    <div class="text-center">
      <h1 class="mt-4">Sales Summary 374959384</h1>
      <p class="lead">Total sales computed from data.csv</p>
    </div>

    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Total Sales</h5>
        <p id="total-sales" class="display-6 fw-bold loading">Calculating...</p>
        <p class="text-muted small">Values are summed from the CSV file at the repository root (data.csv)</p>
      </div>
    </div>

    <div class="card">
      <div class="card-body">
        <h6>Raw CSV Preview</h6>
        <pre id="csv-preview" style="max-height:200px; overflow:auto; background:#f8f9fa; padding:0.75rem; border-radius:0.25rem;"></pre>
      </div>
    </div>
  </main>

  <!-- Bootstrap JS (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Fetch data.csv from repo root and compute sum of "sales" column
    async function fetchAndSumCSV() {
      try {
        const resp = await fetch('data.csv', {cache: "no-store"});
        if (!resp.ok) throw new Error('Failed to fetch data.csv: ' + resp.status);
        const text = await resp.text();

        // Show preview
        document.getElementById('csv-preview').textContent = text.trim();

        // Parse CSV: assume first line is header and columns separated by commas.
        const lines = text.trim().split(/\\r?\\n/).filter(Boolean);
        if (lines.length < 2) {
          document.getElementById('total-sales').textContent = '0.00';
          document.getElementById('total-sales').classList.remove('loading');
          return;
        }

        const header = lines[0].split(',').map(h => h.trim().toLowerCase());
        const salesIndex = header.indexOf('sales');
        if (salesIndex === -1) throw new Error('No sales column found');

        let total = 0;
        for (let i = 1; i < lines.length; i++) {
          const cols = lines[i].split(',');
          // Handle rows that might have commas inside values by joining extras into last column
          if (cols.length > header.length) {
            // merge extras into last column
            const merged = cols.slice(0, header.length - 1).concat([cols.slice(header.length - 1).join(',')]);
            cols.length = 0;
            Array.prototype.push.apply(cols, merged);
          }
          const raw = cols[salesIndex] ? cols[salesIndex].trim() : '';
          if (raw === '') continue;
          const value = parseFloat(raw);
          if (Number.isFinite(value)) total += value;
          // ignore non-numeric entries
        }

        // Format to 2 decimals
        document.getElementById('total-sales').textContent = total.toFixed(2);
        document.getElementById('total-sales').classList.remove('loading');

        // Ensure title matches requirement (redundant but explicit)
        document.title = 'Sales Summary 374959384';
      } catch (err) {
        console.error(err);
        document.getElementById('total-sales').textContent = 'Error';
        document.getElementById('total-sales').classList.remove('loading');
      }
    }

    // Run on load
    window.addEventListener('DOMContentLoaded', fetchAndSumCSV);
  </script>
</body>
</html>